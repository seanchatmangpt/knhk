# Generated OpenTelemetry Weaver Registry
# Auto-generated by ggen from RDF/Turtle workflow specification
# Source ontology: {{workflow_id}}
# Generation timestamp: {{generation_timestamp}}
#
# Validate with: weaver registry check -r registry/

# Registry metadata
registry:
  namespace: "{{workflow_namespace}}"
  version: "{{workflow_version}}"
  description: |
    OpenTelemetry schema for workflow: {{workflow_name}}

# Spans
spans:
  {{#each tasks}}
  - name: "{{../workflow_namespace}}.task.{{snake_case this.name}}"
    brief: "{{this.description}}"
    attributes:
      - name: "task.name"
        type: string
        requirement_level: required
        brief: "Name of the task"
        examples: ["{{this.name}}"]

      - name: "task.type"
        type: string
        requirement_level: required
        brief: "Type of task"
        examples: ["{{this.task_type}}"]

      - name: "task.pattern"
        type: string
        requirement_level: required
        brief: "YAWL pattern used"
        examples: ["{{this.yawl_pattern}}"]

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"
        examples: ["{{../workflow_name}}"]

      - name: "workflow.instance_id"
        type: string
        requirement_level: required
        brief: "Workflow instance identifier"
        examples: ["wf-instance-12345"]

      {{#if this.custom_attributes}}
      {{#each this.custom_attributes}}
      - name: "{{this.name}}"
        type: {{this.type}}
        requirement_level: {{this.requirement_level}}
        brief: "{{this.description}}"
        {{#if this.examples}}
        examples: [{{#each this.examples}}"{{this}}"{{#unless @last}}, {{/unless}}{{/each}}]
        {{/if}}
      {{/each}}
      {{/if}}

  {{/each}}

  {{#each hooks}}
  - name: "{{../workflow_namespace}}.hook.{{snake_case this.name}}"
    brief: "{{this.description}}"
    attributes:
      - name: "hook.name"
        type: string
        requirement_level: required
        brief: "Name of the hook"
        examples: ["{{this.name}}"]

      - name: "hook.trigger"
        type: string
        requirement_level: required
        brief: "Hook trigger event"
        examples: ["{{this.trigger}}"]

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"
        examples: ["{{../workflow_name}}"]

  {{/each}}

  - name: "{{workflow_namespace}}.workflow.execution"
    brief: "Complete workflow execution"
    attributes:
      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"
        examples: ["{{workflow_name}}"]

      - name: "workflow.instance_id"
        type: string
        requirement_level: required
        brief: "Workflow instance identifier"
        examples: ["wf-instance-12345"]

      - name: "workflow.version"
        type: string
        requirement_level: required
        brief: "Workflow version"
        examples: ["{{workflow_version}}"]

      - name: "workflow.start_time"
        type: int
        requirement_level: required
        brief: "Workflow start timestamp (Unix epoch)"
        examples: [1700000000]

      - name: "workflow.end_time"
        type: int
        requirement_level: recommended
        brief: "Workflow end timestamp (Unix epoch)"
        examples: [1700003600]

  - name: "{{workflow_namespace}}.state.transition"
    brief: "State machine transition"
    attributes:
      - name: "state.from"
        type: string
        requirement_level: required
        brief: "Source state"
        examples: ["{{initial_state}}"]

      - name: "state.to"
        type: string
        requirement_level: required
        brief: "Target state"
        examples: [{{#each states}}"{{this.name}}"{{#unless @last}}, {{/unless}}{{/each}}]

      - name: "state.event"
        type: string
        requirement_level: required
        brief: "Transition event"
        examples: [{{#each transitions}}"{{this.event}}"{{#unless @last}}, {{/unless}}{{/each}}]

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"
        examples: ["{{workflow_name}}"]

# Metrics
metrics:
  - name: "{{workflow_namespace}}.task.executions"
    brief: "Number of task executions"
    instrument: counter
    unit: "{execution}"
    attributes:
      - name: "task.name"
        type: string
        requirement_level: required
        brief: "Name of the task"

      - name: "task.success"
        type: boolean
        requirement_level: required
        brief: "Whether task execution succeeded"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

  - name: "{{workflow_namespace}}.task.duration"
    brief: "Task execution duration"
    instrument: histogram
    unit: "ms"
    attributes:
      - name: "task.name"
        type: string
        requirement_level: required
        brief: "Name of the task"

      - name: "task.success"
        type: boolean
        requirement_level: required
        brief: "Whether task execution succeeded"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

  - name: "{{workflow_namespace}}.workflow.completions"
    brief: "Number of workflow completions"
    instrument: counter
    unit: "{completion}"
    attributes:
      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

      - name: "workflow.success"
        type: boolean
        requirement_level: required
        brief: "Whether workflow completed successfully"

  - name: "{{workflow_namespace}}.guard.checks"
    brief: "Number of guard checks performed"
    instrument: counter
    unit: "{check}"
    attributes:
      - name: "guard.name"
        type: string
        requirement_level: required
        brief: "Name of the guard"

      - name: "guard.passed"
        type: boolean
        requirement_level: required
        brief: "Whether guard check passed"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

  - name: "{{workflow_namespace}}.hook.executions"
    brief: "Number of hook executions"
    instrument: counter
    unit: "{execution}"
    attributes:
      - name: "hook.name"
        type: string
        requirement_level: required
        brief: "Name of the hook"

      - name: "hook.success"
        type: boolean
        requirement_level: required
        brief: "Whether hook execution succeeded"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

  - name: "{{workflow_namespace}}.errors"
    brief: "Number of errors encountered"
    instrument: counter
    unit: "{error}"
    attributes:
      - name: "error.type"
        type: string
        requirement_level: required
        brief: "Type of error"

      - name: "error.context"
        type: string
        requirement_level: recommended
        brief: "Error context information"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

# Events
events:
  {{#each events}}
  - name: "{{this.name}}"
    brief: "{{this.description}}"
    attributes:
      {{#each this.attributes}}
      - name: "{{this.name}}"
        type: {{this.type}}
        requirement_level: {{this.requirement_level}}
        brief: "{{this.description}}"
        {{#if this.examples}}
        examples: [{{#each this.examples}}"{{this}}"{{#unless @last}}, {{/unless}}{{/each}}]
        {{/if}}
      {{/each}}

  {{/each}}

# Logs
logs:
  - name: "{{workflow_namespace}}.workflow.log"
    brief: "Workflow execution log"
    attributes:
      - name: "log.level"
        type: string
        requirement_level: required
        brief: "Log level"
        examples: ["INFO", "WARN", "ERROR", "DEBUG"]

      - name: "log.message"
        type: string
        requirement_level: required
        brief: "Log message"

      - name: "workflow.name"
        type: string
        requirement_level: required
        brief: "Workflow name"

      - name: "workflow.instance_id"
        type: string
        requirement_level: recommended
        brief: "Workflow instance identifier"

      - name: "task.name"
        type: string
        requirement_level: recommended
        brief: "Task name (if applicable)"

# Validation rules
validation:
  # Ensure all spans have required attributes
  - rule: "span_required_attributes"
    description: "All spans must have required attributes"

  # Ensure metric names follow convention
  - rule: "metric_naming_convention"
    description: "Metrics must follow {namespace}.{component}.{name} convention"

  # Ensure histogram buckets are configured
  - rule: "histogram_buckets"
    description: "Histogram metrics must define explicit buckets"
