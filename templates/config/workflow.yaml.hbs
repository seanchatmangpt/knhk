# Generated Workflow Configuration
# Auto-generated by ggen from RDF/Turtle workflow specification
# Source ontology: {{workflow_id}}
# Generation timestamp: {{generation_timestamp}}
#
# DO NOT EDIT MANUALLY - regenerate using:
# npx ggen generate --template config/workflow.yaml.hbs --ontology {{ontology_path}}

# Workflow metadata
workflow:
  id: "{{workflow_id}}"
  name: "{{workflow_name}}"
  version: "{{workflow_version}}"
  description: |
    {{workflow_description}}

  # YAWL compliance
  yawl:
    patterns_used:
      {{#each yawl_patterns}}
      - pattern: "{{this.name}}"
        id: "{{this.id}}"
        count: {{this.usage_count}}
      {{/each}}
    compliance_level: "{{yawl_compliance_level}}"

# Tasks configuration
tasks:
  {{#each tasks}}
  - id: "{{this.id}}"
    name: "{{this.name}}"
    type: "{{this.task_type}}"
    pattern: "{{this.yawl_pattern}}"
    description: |
      {{this.description}}

    # Task inputs
    inputs:
      {{#each this.inputs}}
      - name: "{{this.name}}"
        type: "{{this.type}}"
        required: {{this.required}}
        {{#if this.default}}
        default: {{this.default}}
        {{/if}}
      {{/each}}

    # Task outputs
    outputs:
      {{#each this.outputs}}
      - name: "{{this.name}}"
        type: "{{this.type}}"
      {{/each}}

    # Guards
    {{#if this.guards}}
    guards:
      {{#each this.guards}}
      - name: "{{this.name}}"
        type: "{{this.type}}"
        expression: "{{this.expression}}"
        max_run_len: {{this.max_run_len}}
      {{/each}}
    {{/if}}

    # Performance constraints
    performance:
      max_duration_ms: {{this.max_duration_ms}}
      timeout_ms: {{this.timeout_ms}}
      retry_count: {{this.retry_count}}

  {{/each}}

# State machine configuration
states:
  initial: "{{initial_state}}"

  definitions:
    {{#each states}}
    - name: "{{this.name}}"
      type: "{{this.type}}"
      is_final: {{this.is_final}}
      is_error: {{this.is_error}}
      {{#if this.timeout_ms}}
      timeout_ms: {{this.timeout_ms}}
      {{/if}}
    {{/each}}

  transitions:
    {{#each transitions}}
    - from: "{{this.from}}"
      to: "{{this.to}}"
      event: "{{this.event}}"
      {{#if this.guards}}
      guards:
        {{#each this.guards}}
        - "{{this}}"
        {{/each}}
      {{/if}}
      {{#if this.condition}}
      condition: "{{this.condition}}"
      {{/if}}
    {{/each}}

# Hooks configuration
hooks:
  {{#each hooks}}
  - name: "{{this.name}}"
    trigger: "{{this.trigger}}"
    type: "{{this.type}}"
    pattern: "{{this.yawl_pattern}}"

    # Hook execution
    execution:
      async: {{this.async}}
      timeout_ms: {{this.timeout_ms}}
      retry_policy:
        max_attempts: {{this.retry_max_attempts}}
        backoff_ms: {{this.retry_backoff_ms}}

    {{#if this.guards}}
    # Guards
    guards:
      {{#each this.guards}}
      - "{{this}}"
      {{/each}}
    {{/if}}

    {{#if this.sparql_query}}
    # SPARQL integration
    sparql:
      query: |
        {{this.sparql_query}}
      endpoint: "{{this.sparql_endpoint}}"
    {{/if}}

  {{/each}}

# Guard constraints
guards:
  # Global guard constraints (Chatman Constant)
  global:
    max_run_len: 8
    max_ticks: 8
    max_duration_ns: 2

  # Pattern-specific guards
  patterns:
    {{#each guard_patterns}}
    - pattern: "{{this.pattern}}"
      max_run_len: {{this.max_run_len}}
      constraints:
        {{#each this.constraints}}
        - type: "{{this.type}}"
          value: {{this.value}}
        {{/each}}
    {{/each}}

# MAPE-K configuration (Monitor, Analyze, Plan, Execute, Knowledge)
mape_k:
  # Monitor phase
  monitor:
    metrics:
      - task_execution_time
      - guard_check_results
      - state_transition_events
      - hook_execution_success

    telemetry:
      enabled: true
      export_interval_ms: 1000
      batch_size: 100

  # Analyze phase
  analyze:
    thresholds:
      task_duration_p95_ms: 100
      error_rate_threshold: 0.01
      guard_failure_rate: 0.05

    anomaly_detection:
      enabled: true
      sensitivity: 0.95

  # Plan phase
  plan:
    policies:
      {{#each policies}}
      - name: "{{this.name}}"
        condition: "{{this.condition}}"
        action: "{{this.action}}"
        priority: {{this.priority}}
      {{/each}}

  # Execute phase
  execute:
    execution_mode: "{{execution_mode}}"
    parallelism: {{parallelism}}
    circuit_breaker:
      enabled: true
      failure_threshold: 5
      timeout_ms: 30000
      reset_timeout_ms: 60000

  # Knowledge phase
  knowledge:
    persistence:
      enabled: true
      backend: "{{knowledge_backend}}"
      connection: "{{knowledge_connection}}"

    reasoning:
      enabled: {{knowledge_reasoning_enabled}}
      engine: "{{knowledge_reasoning_engine}}"

# Observability configuration
observability:
  # OpenTelemetry
  otel:
    enabled: true
    service_name: "{{workflow_name}}"

    # Tracing
    tracing:
      enabled: true
      sampler: "{{otel_trace_sampler}}"
      exporter: "{{otel_trace_exporter}}"
      endpoint: "{{otel_trace_endpoint}}"

    # Metrics
    metrics:
      enabled: true
      exporter: "{{otel_metrics_exporter}}"
      endpoint: "{{otel_metrics_endpoint}}"
      export_interval_ms: 1000

    # Logs
    logs:
      enabled: true
      level: "{{otel_log_level}}"
      exporter: "{{otel_log_exporter}}"
      endpoint: "{{otel_log_endpoint}}"

  # Lockchain provenance
  lockchain:
    enabled: {{lockchain_enabled}}
    receipt_generation: "{{lockchain_receipt_mode}}"
    storage:
      backend: "{{lockchain_storage_backend}}"
      path: "{{lockchain_storage_path}}"

# Performance constraints
performance:
  # Chatman Constant (τ ≤ 8 ticks, ≤2ns)
  chatman_constant:
    max_ticks: 8
    max_duration_ns: 2

  # Path selection
  hot_path:
    enabled: true
    max_triples: 8
    operations: ["ASK", "COUNT", "COMPARE", "VALIDATE"]

  warm_path:
    enabled: true
    max_triples: 10000
    max_duration_ms: 500
    operations: ["SELECT", "CONSTRUCT", "DESCRIBE"]

  cold_path:
    enabled: true
    operations: ["UPDATE", "SHACL", "REASONING"]

# Validation
validation:
  # Schema validation
  schema:
    enabled: true
    strict: true
    validate_inputs: true
    validate_outputs: true

  # Weaver validation
  weaver:
    enabled: true
    registry_path: "{{weaver_registry_path}}"
    live_check: true

  # Definition of Done
  dod:
    enabled: true
    checks:
      - compilation
      - clippy_warnings
      - weaver_validation
      - functional_tests
      - performance_tests
