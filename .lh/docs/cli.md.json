{
    "sourceFile": "docs/cli.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762445799806,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762445799806,
            "name": "Commit-0",
            "content": "# KNHK CLI Guide\n\n**Version**: 0.5.0  \n**Status**: ✅ Production Ready  \n**CLI Reference**: Complete command reference for all operations\n\n**Formal Foundation**: CLI commands enforce formal laws:\n- **Typing**: O ⊨ Σ - Schema validation before operations\n- **Law**: A = μ(O) - Actions are deterministic projections\n- **Epoch Containment**: μ ⊂ τ - Time bounds enforced\n- **Provenance**: hash(A) = hash(μ(O)) - Receipt generation\n\nSee [Formal Mathematical Foundations](formal-foundations.md) for complete treatment.\n\n## Overview\n\nThe KNHK CLI provides a noun-verb interface based on the CONVO.txt API specification. All commands follow the pattern:\n\n```bash\nknhk <noun> <verb> [arguments]\n```\n\n## Installation\n\n```bash\ncd rust/knhk-cli\ncargo build --release\ncargo install --path .\n```\n\n## Configuration\n\nKNHK uses TOML configuration files with environment variable override support.\n\n### Configuration File Location\n\n- **Unix/macOS**: `~/.knhk/config.toml`\n- **Windows**: `%APPDATA%/knhk/config.toml`\n\n### Configuration Hierarchy\n\nConfiguration values are loaded in this order (highest priority first):\n1. Environment variables (`KNHK_*`)\n2. Configuration file (`~/.knhk/config.toml`)\n3. Default values\n\n### Example Configuration File\n\n```toml\n[knhk]\nversion = \"0.5.0\"\ncontext = \"default\"\n\n[connectors.kafka-prod]\ntype = \"kafka\"\nbootstrap_servers = [\"localhost:9092\"]\ntopic = \"triples\"\nschema = \"urn:knhk:schema:enterprise\"\nmax_run_len = 8\nmax_batch_size = 1000\n\n[epochs.default]\ntau = 8\nordering = \"deterministic\"\n\n[hooks]\nmax_count = 100\n\n[routes.webhook-1]\nkind = \"webhook\"\ntarget = \"https://api.example.com/webhook\"\nencode = \"json-ld\"\n```\n\n### Environment Variables\n\nEnvironment variables override configuration file values:\n\n- `KNHK_CONTEXT` - Set default context\n- `KNHK_CONNECTOR_<NAME>_BOOTSTRAP_SERVERS` - Connector bootstrap servers (comma-separated)\n- `KNHK_CONNECTOR_<NAME>_TOPIC` - Connector topic\n- `KNHK_CONNECTOR_<NAME>_SCHEMA` - Connector schema\n- `KNHK_CONNECTOR_<NAME>_MAX_RUN_LEN` - Connector max run length (must be ≤ 8)\n- `KNHK_EPOCH_<NAME>_TAU` - Epoch tau value (must be ≤ 8)\n- `KNHK_EPOCH_<NAME>_ORDERING` - Epoch ordering\n\nExample:\n```bash\nexport KNHK_CONTEXT=production\nexport KNHK_CONNECTOR_KAFKA_PROD_BOOTSTRAP_SERVERS=localhost:9092,localhost:9093\nexport KNHK_EPOCH_DEFAULT_TAU=8\n```\n\n## Commands\n\n### Boot - System Initialization\n\n**Initialize Σ and Q**\n```bash\nknhk boot init <sigma.ttl> <q.sparql>\n```\n\nInitializes the system with schema (Σ) and invariants (Q).\n\nExample:\n```bash\nknhk boot init schema.ttl invariants.sparql\n```\n\n### Connect - Connector Management\n\n**Register Connector**\n```bash\nknhk connect register <name> <schema> <source>\n```\n\nRegisters a connector for data ingestion. Supports Kafka, Salesforce, HTTP, and file sources.\n\n**List Connectors**\n```bash\nknhk connect list\n```\n\nExamples:\n```bash\n# Register Kafka connector\nknhk connect register kafka-prod urn:knhk:schema:default kafka://localhost:9092/triples\n\n# Register Salesforce connector\nknhk connect register sf-prod urn:knhk:schema:salesforce salesforce://instance.salesforce.com\n\n# List connectors\nknhk connect list\n```\n\n### Cover - Cover Definition\n\n**Define Cover**\n```bash\nknhk cover define <select> <shard>\n```\n\nDefines a cover over the ontology O with shard constraints.\n\n**List Covers**\n```bash\nknhk cover list\n```\n\nExample:\n```bash\nknhk cover define \"SELECT ?s ?p ?o WHERE { ?s ?p ?o }\" \"max_run_len 8\"\n```\n\n### Admit - Delta Admission\n\n**Admit Delta**\n```bash\nknhk admit delta <delta_file>\n```\n\nAdmits a delta (Δ) into the ontology O.\n\nExample:\n```bash\nknhk admit delta delta.json\n```\n\n### Reflex - Reflex Declaration\n\n**Declare Reflex**\n```bash\nknhk reflex declare <name> <op> <pred> <off> <len>\n```\n\nDeclares a reflex (hook) with operation, predicate, offset, and length.\n\n**List Reflexes**\n```bash\nknhk reflex list\n```\n\nExample:\n```bash\nknhk reflex declare check-count ASK_SP 0xC0FFEE 0 8\n```\n\nValid operations (H_hot set):\n- **Hot Path** (≤8 ticks): ASK_SP, ASK_SPO, ASK_OP, COUNT_SP_GE/LE/EQ, COUNT_OP_GE/LE/EQ, UNIQUE_SP, COMPARE_O_EQ/GT/LT/GE/LE, VALIDATE_DATATYPE_SP/SPO\n- **Warm Path** (≤500ms): CONSTRUCT8\n\n### Epoch - Epoch Operations\n\n**Create Epoch**\n```bash\nknhk epoch create <id> <tau> <lambda>\n```\n\nCreates an epoch with tau (≤8) and lambda (ordering).\n\n**Run Epoch**\n```bash\nknhk epoch run <id>\n```\n\n**List Epochs**\n```bash\nknhk epoch list\n```\n\nExample:\n```bash\nknhk epoch create epoch1 8 \"reflex1,reflex2\"\nknhk epoch run epoch1\n```\n\n### Route - Action Routing\n\n**Install Route**\n```bash\nknhk route install <name> <kind> <target>\n```\n\nInstalls a route for action delivery.\n\n**List Routes**\n```bash\nknhk route list\n```\n\nRoute kinds:\n- `webhook` - HTTP webhook (http:// or https://)\n- `kafka` - Kafka topic (kafka://brokers/topic)\n- `grpc` - gRPC endpoint (grpc://host:port/service/method)\n- `lockchain` - Git lockchain (file:// or git://)\n\nExample:\n```bash\nknhk route install webhook1 webhook https://api.example.com/webhook\nknhk route install kafka1 kafka kafka://localhost:9092/actions\n```\n\n### Receipt - Receipt Operations\n\n**Get Receipt**\n```bash\nknhk receipt get <id>\n```\n\n**Merge Receipts**\n```bash\nknhk receipt merge <id1,id2,id3>\n```\n\n**List Receipts**\n```bash\nknhk receipt list\n```\n\n**Verify Receipt**\n```bash\nknhk receipt verify <id>\n```\n\n**Show Receipt**\n```bash\nknhk receipt show <id>\n```\n\nExample:\n```bash\nknhk receipt get receipt-123\nknhk receipt merge receipt-1,receipt-2,receipt-3\nknhk receipt verify receipt-123\n```\n\n### Pipeline - ETL Pipeline\n\n**Run Pipeline**\n```bash\nknhk pipeline run [--connectors <ids>] [--schema <iri>]\n```\n\nExecutes the ETL pipeline: Ingest → Transform → Load → Reflex → Emit\n\n**Pipeline Status**\n```bash\nknhk pipeline status\n```\n\nExample:\n```bash\nknhk pipeline run --connectors kafka-prod\nknhk pipeline status\n```\n\n### Metrics - OTEL Metrics\n\n**Get Metrics**\n```bash\nknhk metrics get\n```\n\nRetrieves OpenTelemetry metrics.\n\n### Coverage - Dark Matter Coverage\n\n**Get Coverage**\n```bash\nknhk coverage get\n```\n\nRetrieves 80/20 coverage metrics.\n\n### Hook - Knowledge Hook Operations\n\n**Create Hook**\n```bash\nknhk hook create <name> <op> <pred> <off> <len> [s] [p] [o] [k]\n```\n\nCreates a knowledge hook with operation and parameters.\n\n**List Hooks**\n```bash\nknhk hook list\n```\n\n**Evaluate Hook**\n```bash\nknhk hook eval <name>\n```\n\nEvaluates a hook (routes to hot path or warm path based on operation).\n\n**Show Hook**\n```bash\nknhk hook show <name>\n```\n\nExample:\n```bash\n# Create hot path hook (ASK_SP)\nknhk hook create check-exists ASK_SP 0xC0FFEE 0 8 0x1234\n\n# Create warm path hook (CONSTRUCT8)\nknhk hook create emit-triples CONSTRUCT8 0xC0FFEE 0 8 0x1234 0x5678\n\n# Evaluate hook\nknhk hook eval check-exists\n```\n\n### Context - Context Management\n\n**Create Context**\n```bash\nknhk context create <id> <name> <schema>\n```\n\n**List Contexts**\n```bash\nknhk context list\n```\n\n**Show Current Context**\n```bash\nknhk context current\n```\n\n**Switch Context**\n```bash\nknhk context switch <id>\n```\n\nExample:\n```bash\nknhk context create prod \"Production\" urn:knhk:schema:enterprise\nknhk context switch prod\nknhk context current\n```\n\n## Command Reference Table\n\n| Noun | Verb | Description | Path |\n|------|------|-------------|------|\n| boot | init | Initialize Σ and Q | - |\n| connect | register | Register connector | - |\n| connect | list | List connectors | - |\n| cover | define | Define cover | - |\n| cover | list | List covers | - |\n| admit | delta | Admit delta | - |\n| reflex | declare | Declare reflex | Hot/Warm |\n| reflex | list | List reflexes | - |\n| epoch | create | Create epoch | - |\n| epoch | run | Run epoch | Hot/Warm |\n| epoch | list | List epochs | - |\n| route | install | Install route | - |\n| route | list | List routes | - |\n| receipt | get | Get receipt | - |\n| receipt | merge | Merge receipts | - |\n| receipt | list | List receipts | - |\n| receipt | verify | Verify receipt | - |\n| receipt | show | Show receipt | - |\n| pipeline | run | Run pipeline | - |\n| pipeline | status | Pipeline status | - |\n| metrics | get | Get metrics | - |\n| coverage | get | Get coverage | - |\n| hook | create | Create hook | - |\n| hook | list | List hooks | - |\n| hook | eval | Evaluate hook | Hot/Warm |\n| hook | show | Show hook | - |\n| context | create | Create context | - |\n| context | list | List contexts | - |\n| context | current | Show current context | - |\n| context | switch | Switch context | - |\n\n**Total**: 25 commands\n\n## Troubleshooting\n\n### Configuration Issues\n\n**Problem**: Config file not found\n- **Solution**: Config file will be created automatically on first use, or create `~/.knhk/config.toml` manually\n\n**Problem**: Environment variables not working\n- **Solution**: Ensure environment variables use `KNHK_` prefix and correct naming pattern (e.g., `KNHK_CONNECTOR_NAME_FIELD`)\n\n**Problem**: Validation errors (max_run_len > 8, tau > 8)\n- **Solution**: Ensure guard constraints are met: max_run_len ≤ 8, tau ≤ 8\n\n### Path Routing Issues\n\n**Problem**: CONSTRUCT8 operations timing out\n- **Solution**: CONSTRUCT8 is routed to warm path (≤500ms). If timing out, check system load and warm path metrics\n\n**Problem**: Hot path operations exceeding 8 ticks\n- **Solution**: Verify data is in L1 cache, check predicate run size ≤ 8, ensure branchless operations\n\n### Connector Issues\n\n**Problem**: Kafka connector not connecting\n- **Solution**: Check bootstrap servers are reachable, verify topic exists, check network connectivity\n\n**Problem**: Connector not found\n- **Solution**: Ensure connector is registered with `knhk connect register`, check connector name spelling\n\n## Examples\n\nSee `examples/` directory for complete working examples:\n- `basic-hook/` - Basic hook execution\n- `kafka-connector/` - Kafka connector setup\n- `etl-pipeline/` - Full ETL pipeline\n- `receipt-verification/` - Receipt verification\n- `cli-usage/` - CLI usage examples\n\n## See Also\n\n- [Architecture](architecture.md) - System architecture\n- [API Reference](api.md) - API documentation\n- [v0.5.0 Status](archived/v0.4.0/v0.4.0-status.md) - Release status (v0.5.0 updates in progress)"
        }
    ]
}