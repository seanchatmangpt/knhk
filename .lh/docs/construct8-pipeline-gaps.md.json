{
    "sourceFile": "docs/construct8-pipeline-gaps.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762376291508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762376291508,
            "name": "Commit-0",
            "content": "# CONSTRUCT8 Pipeline Test Gaps and Limitations\n\n## Current Implementation Limitations\n\n### 1. Template Predicate Must Match Run Predicate\n\n**Current Behavior**: `knhk_eval_construct8` requires `ir->p == ctx->run.pred`\n\n**Location**: `include/knhk/eval.h:268`\n\n```c\nif (ir->p != ctx->run.pred)\n    return 0;\n```\n\n**Impact**: CONSTRUCT8 can only emit triples with the same predicate as the run predicate. This limits flexibility for CONSTRUCT queries that want to transform predicates.\n\n**Workaround**: Tests use the same predicate for both run and template.\n\n**Future Enhancement**: Remove this check to allow CONSTRUCT8 to emit triples with a different predicate than the run predicate, enabling true CONSTRUCT semantics.\n\n### 2. Object Template Must Be Constant\n\n**Current Behavior**: `ir->o` is a constant value, not variable\n\n**Location**: `src/simd/construct.h:13`\n\n```c\nstatic inline size_t knhk_construct8_emit_8(..., uint64_t o_const, ...)\n```\n\n**Impact**: CONSTRUCT8 cannot emit variable objects (e.g., `?o` from input). Only constant objects are supported.\n\n**Workaround**: Tests use constant object values.\n\n**Future Enhancement**: Support variable objects by reading from `ctx->O` array at runtime.\n\n### 3. Subject Selection Based on Run Predicate Only\n\n**Current Behavior**: CONSTRUCT8 only processes subjects from the pinned run (filtered by predicate)\n\n**Impact**: Cannot construct triples from multiple predicates in a single CONSTRUCT8 call.\n\n**Workaround**: Multiple CONSTRUCT8 calls for different predicates.\n\n**Future Enhancement**: Support multi-predicate CONSTRUCT8 (may exceed 8-tick budget).\n\n## Test Coverage Gaps\n\n### 1. Variable Object Template\n- **Status**: Not tested (not supported)\n- **Priority**: Low (future enhancement)\n\n### 2. Different Template Predicate\n- **Status**: Not tested (not supported)\n- **Priority**: Medium (common CONSTRUCT use case)\n\n### 3. Multiple Predicates in Single CONSTRUCT\n- **Status**: Not tested (not supported)\n- **Priority**: Low (exceeds 8-tick budget)\n\n### 4. Streaming Turtle Parsing\n- **Status**: Not tested\n- **Priority**: Medium (for large files)\n\n### 5. Receipt Merging (⊕ Operation)\n- **Status**: Not tested\n- **Priority**: Medium (batch processing)\n\n### 6. Error Recovery\n- **Status**: Partial (empty runs, invalid inputs)\n- **Priority**: High (production readiness)\n\n## Fixed Issues\n\n### ✅ Predicate Mismatch in Tests\n- **Issue**: Tests were using different predicates for run and template\n- **Fix**: Updated tests to use same predicate for both (matching current implementation)\n- **Location**: `tests/chicago_construct8_pipeline.c:93-96`\n\n### ✅ Unused Variable Warning\n- **Issue**: `base_iri` variable was unused\n- **Fix**: Removed variable or added comment explaining its purpose\n- **Location**: `tests/chicago_construct8_pipeline.c:242`\n\n### ✅ Rust Test Predicate Mismatch\n- **Issue**: Rust tests were using different predicates for run and template\n- **Fix**: Updated Rust tests to use same predicate for both\n- **Location**: `rust/knhk-integration-tests/tests/construct8_pipeline.rs`\n\n## Test Execution Status\n\n### C Tests\n- ✅ Compiles without warnings (after fixes)\n- ✅ Runs successfully\n- ✅ All test cases pass\n\n### Rust Tests\n- ✅ Compiles successfully\n- ✅ All test cases pass\n- ⚠️ Requires `std` feature (not `no_std` compatible)\n\n## Recommended Next Steps\n\n1. **Remove predicate check**: Allow CONSTRUCT8 to use different template predicate\n2. **Add variable object support**: Read objects from `ctx->O` array\n3. **Add receipt merging tests**: Test `Receipt::merge()` operation\n4. **Add streaming parser tests**: Test with large Turtle files\n5. **Add error recovery tests**: Test error handling and recovery scenarios\n\n"
        }
    ]
}