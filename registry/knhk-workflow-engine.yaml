# KNHK Workflow Engine Telemetry Schema
# Defines spans, metrics, and attributes for the workflow engine service

groups:
  # Workflow engine-specific attributes
  - id: knhk.workflow_engine.attributes
    type: attribute_group
    brief: "Workflow engine-specific attributes"
    stability: experimental
    attributes:
      - id: knhk.workflow_engine.success
        type: boolean
        stability: experimental
        brief: "Whether the workflow operation succeeded"
      - id: knhk.workflow_engine.latency_ms
        type: int
        stability: experimental
        brief: "Operation latency in milliseconds"
      - id: knhk.workflow_engine.operation
        type: string
        stability: experimental
        brief: "Workflow operation name"
        examples: ["register_workflow", "create_case", "execute_case", "get_case_history"]
      - id: knhk.workflow_engine.spec_id
        type: string
        stability: experimental
        brief: "Workflow specification identifier (UUID)"
        examples: ["550e8400-e29b-41d4-a716-446655440000"]
      - id: knhk.workflow_engine.case_id
        type: string
        stability: experimental
        brief: "Case identifier (UUID)"
        examples: ["550e8400-e29b-41d4-a716-446655440000"]
      - id: knhk.workflow_engine.pattern_id
        type: int
        stability: experimental
        brief: "Van der Aalst workflow pattern ID (1-43)"
        examples: [1, 2, 3, 12, 15, 26, 43]
      - id: knhk.workflow_engine.task_id
        type: string
        stability: experimental
        brief: "Task identifier"
        examples: ["task_1", "task_approve"]
      - id: knhk.workflow_engine.case_state
        type: string
        stability: experimental
        brief: "Case state"
        examples: ["Created", "Running", "Completed", "Cancelled"]

  # Workflow registration span
  - id: knhk.workflow_engine.register_workflow
    type: span
    span_kind: internal
    stability: experimental
    brief: "Register a workflow specification"
    note: |
      Registers a workflow specification (YAWL/Turtle format) with the engine.
      Validates the specification and stores it for execution.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.operation
      - ref: knhk.workflow_engine.spec_id

  # Case creation span
  - id: knhk.workflow_engine.create_case
    type: span
    span_kind: internal
    stability: experimental
    brief: "Create a new workflow case"
    note: |
      Creates a new case instance for a workflow specification.
      Initializes case data and state.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.operation
      - ref: knhk.workflow_engine.spec_id
      - ref: knhk.workflow_engine.case_id
      - ref: knhk.workflow_engine.case_state

  # Case execution span
  - id: knhk.workflow_engine.execute_case
    type: span
    span_kind: internal
    stability: experimental
    brief: "Execute a workflow case"
    note: |
      Executes a workflow case, running tasks and handling patterns.
      Follows workflow flows from start condition to end condition.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.operation
      - ref: knhk.workflow_engine.case_id
      - ref: knhk.workflow_engine.case_state

  # Task execution span
  - id: knhk.workflow_engine.execute_task
    type: span
    span_kind: internal
    stability: experimental
    brief: "Execute a workflow task"
    note: |
      Executes a single task within a workflow case.
      Handles resource allocation, connector execution, and output production.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.case_id
      - ref: knhk.workflow_engine.task_id
      - ref: knhk.workflow_engine.pattern_id

  # Pattern execution span
  - id: knhk.workflow_engine.execute_pattern
    type: span
    span_kind: internal
    stability: experimental
    brief: "Execute a Van der Aalst workflow pattern"
    note: |
      Executes a workflow pattern (1-43) following Van der Aalst's pattern-based execution methodology.
      Patterns include basic control flow, advanced branching, multiple instance, state-based, cancellation, etc.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.pattern_id
      - ref: knhk.workflow_engine.case_id

  # Case history query span
  - id: knhk.workflow_engine.get_case_history
    type: span
    span_kind: internal
    stability: experimental
    brief: "Get case history (audit trail)"
    note: |
      Retrieves the complete history of events for a case.
      Includes case creation, state changes, task starts/completions.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.operation
      - ref: knhk.workflow_engine.case_id

  # Multiple instance execution span
  - id: knhk.workflow_engine.execute_mi_task
    type: span
    span_kind: internal
    stability: experimental
    brief: "Execute multiple instance task"
    note: |
      Executes a multiple instance task (Patterns 12-15).
      Spawns parallel instances and waits for all to complete.
    attributes:
      - ref: knhk.operation.name
      - ref: knhk.operation.type
      - ref: knhk.workflow_engine.success
      - ref: knhk.workflow_engine.latency_ms
      - ref: knhk.workflow_engine.case_id
      - ref: knhk.workflow_engine.task_id
      - ref: knhk.workflow_engine.pattern_id
      - id: knhk.workflow_engine.instance_count
        type: int
        stability: experimental
        brief: "Number of instances to execute"
        examples: [1, 5, 10]
