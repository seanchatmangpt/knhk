# ggen v2.7.1 CLI Examples

Complete guide to using the KNHK code generation CLI commands.

## Table of Contents

- [Workflow Generation](#workflow-generation)
- [Test Generation](#test-generation)
- [Hook Generation](#hook-generation)
- [Code Validation](#code-validation)
- [Template Management](#template-management)
- [Marketplace Integration](#marketplace-integration)
- [Advanced Workflows](#advanced-workflows)

---

## Workflow Generation

### Basic Workflow Generation

Generate Rust workflow from Turtle specification:

```bash
knhk gen workflow spec.ttl
```

Output:
```
⏳ Generating workflow from specification...
✅ Generating workflow from specification - Generated to stdout (0.45s)

//! Generated Workflow
//! Source: spec.ttl
//! Generated by: KNHK ggen v2.7.1
//! Language: Rust

use std::sync::Arc;
use serde::{Serialize, Deserialize};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct WorkflowSpec {
    pub name: String,
    pub version: String,
    pub nodes: Vec<WorkflowNode>,
}
...
```

### Generate with Output File

Save to specific file:

```bash
knhk gen workflow spec.ttl --output src/workflow.rs
```

Output:
```
⏳ Generating workflow from specification...
✅ Generating workflow from specification - Generated to src/workflow.rs (0.52s)
```

### Generate Python Workflow

Generate Python code instead of Rust:

```bash
knhk gen workflow spec.ttl --language python --output workflow.py
```

Output:
```python
"""Generated Workflow
Source: spec.ttl
Generated by: KNHK ggen v2.7.1
Language: Python
"""

from typing import List, Dict, Any
from dataclasses import dataclass

@dataclass
class WorkflowSpec:
    name: str
    version: str
    nodes: List[WorkflowNode]
...
```

### Generate with Telemetry

Include OpenTelemetry instrumentation:

```bash
knhk gen workflow spec.ttl \
  --emit-telemetry \
  --output src/workflow.rs
```

Generated code includes:
```rust
#[cfg(feature = "otel")]
use tracing::{instrument, info, error};

impl WorkflowSpec {
    #[cfg_attr(feature = "otel", instrument(skip(self)))]
    pub fn execute(&self) -> Result<(), Box<dyn std::error::Error>> {
        #[cfg(feature = "otel")]
        info!(workflow = %self.name, "workflow.execute.start");
        // ...
    }
}
```

### Generate with Knowledge Hooks

Include hook integration:

```bash
knhk gen workflow spec.ttl \
  --emit-hooks \
  --emit-telemetry \
  --output src/workflow.rs
```

### Generate and Validate

Generate and validate against Weaver schema:

```bash
knhk gen workflow spec.ttl \
  --output src/workflow.rs \
  --validate \
  --emit-telemetry
```

Output:
```
⏳ Generating workflow from specification...
✅ Generating workflow from specification - Generated to src/workflow.rs (0.48s)
⏳ Validating against Weaver schema...
✅ Validating against Weaver schema - Validation skipped (not implemented) (0.01s)
```

### Multi-Language Generation

Generate for all supported languages:

```bash
# Rust
knhk gen workflow spec.ttl --language rust --output workflow.rs

# Python
knhk gen workflow spec.ttl --language python --output workflow.py

# JavaScript
knhk gen workflow spec.ttl --language js --output workflow.js

# Go
knhk gen workflow spec.ttl --language go --output workflow.go
```

### JSON Output Mode

Get machine-readable output:

```bash
knhk gen workflow spec.ttl --format json
```

Output:
```json
{
  "spec_file": "spec.ttl",
  "output_file": null,
  "language": "rust",
  "telemetry_enabled": false,
  "hooks_enabled": false,
  "validated": false
}
```

---

## Test Generation

### Basic Test Generation

Generate Chicago TDD tests:

```bash
knhk gen tests spec.ttl
```

Output:
```
⏳ Generating Chicago TDD tests...
✅ Generating Chicago TDD tests - Generated tests to tests/generated_tests.rs (0.38s)
```

### Custom Output Directory

Specify test output location:

```bash
knhk gen tests spec.ttl --output src/tests/
```

### Target Coverage

Set coverage percentage:

```bash
knhk gen tests spec.ttl --coverage 95
```

### Python Tests

Generate pytest-compatible tests:

```bash
knhk gen tests spec.ttl \
  --language python \
  --output tests/ \
  --coverage 90
```

Output `tests/test_generated.py`:
```python
"""Generated Chicago TDD Tests
Source: spec.ttl
Target Coverage: 90%
"""

import unittest
from workflow import WorkflowSpec, WorkflowNode

class TestWorkflow(unittest.TestCase):
    def test_workflow_creation(self):
        workflow = WorkflowSpec("test-workflow")
        self.assertEqual(workflow.name, "test-workflow")
    ...
```

### Custom Template

Use custom test template:

```bash
knhk gen tests spec.ttl \
  --template templates/custom-test.tmpl \
  --output tests/
```

### JSON Output

Get test generation report:

```bash
knhk gen tests spec.ttl --format json
```

Output:
```json
{
  "spec_file": "spec.ttl",
  "output_dir": "tests",
  "language": "rust",
  "coverage_target": 90,
  "test_count": 5
}
```

---

## Hook Generation

### Basic Hook Generation

Generate knowledge hook:

```bash
knhk gen hook hook-def.ttl
```

Output:
```
⏳ Generating knowledge hook...
✅ Generating knowledge hook - Generated to stdout (0.32s)

//! Generated Knowledge Hook
//! Source: hook-def.ttl

use std::sync::Arc;
use serde::{Serialize, Deserialize};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct KnowledgeHook {
    pub id: String,
    pub name: String,
    pub description: String,
}
...
```

### Hook with Lockchain

Generate hook with Lockchain receipt support:

```bash
knhk gen hook hook-def.ttl \
  --with-lockchain \
  --output src/hooks/custom.rs
```

Generated code includes:
```rust
use knhk_lockchain::{LockchainStorage, Receipt};

impl KnowledgeHook {
    pub fn execute_with_receipt(&self, context: &HookContext)
        -> Result<(HookResult, Receipt), HookError>
    {
        // Generate Lockchain receipt
        let receipt = Receipt::new(...);
        // ...
    }
}
```

### Hook with Telemetry

Generate hook with OTEL instrumentation:

```bash
knhk gen hook hook-def.ttl \
  --with-telemetry \
  --output src/hooks/monitored.rs
```

Generated code includes:
```rust
#[cfg(feature = "otel")]
use tracing::{instrument, info};

impl KnowledgeHook {
    #[cfg_attr(feature = "otel", instrument(skip(self)))]
    pub fn execute(&self, context: &HookContext) -> Result<HookResult, HookError> {
        #[cfg(feature = "otel")]
        info!(hook_id = %self.id, "hook.execute.start");
        // ...
    }
}
```

### Complete Hook (Lockchain + Telemetry)

Generate fully-featured hook:

```bash
knhk gen hook hook-def.ttl \
  --with-lockchain \
  --with-telemetry \
  --output src/hooks/production.rs
```

---

## Code Validation

### Basic Validation

Validate generated code:

```bash
knhk gen validate src/workflow.rs
```

Output:
```
⏳ Validating generated code...
✅ Validating generated code - Validation passed with warnings (0.18s)

Code Path: src/workflow.rs
Schema Valid: ✅
Telemetry Valid: ✅
Performance Valid: ✅
Weaver Valid: ✅

Warnings:
- No schema provided - skipping schema validation
- Telemetry validation not yet implemented
- Performance validation not yet implemented
- Weaver validation not yet implemented
```

### Validate with Schema

Validate against custom schema:

```bash
knhk gen validate src/workflow.rs --schema schema.yaml
```

### Telemetry Validation

Check OTEL compliance:

```bash
knhk gen validate src/workflow.rs --telemetry
```

### Performance Validation

Verify performance constraints (≤8 ticks for hot path):

```bash
knhk gen validate src/workflow.rs --performance
```

### Weaver Validation (Source of Truth)

Run Weaver live-check validation:

```bash
knhk gen validate src/workflow.rs --weaver
```

This is the ONLY true validation - proves features work at runtime.

### Complete Validation

Run all validation checks:

```bash
knhk gen validate src/workflow.rs \
  --schema registry/workflow-schema.yaml \
  --telemetry \
  --performance \
  --weaver
```

### JSON Validation Report

Get machine-readable validation report:

```bash
knhk gen validate src/workflow.rs --weaver --format json
```

Output:
```json
{
  "code_path": "src/workflow.rs",
  "schema_valid": true,
  "telemetry_valid": true,
  "performance_valid": true,
  "weaver_valid": true,
  "issues": [],
  "warnings": [
    "Weaver validation not yet implemented"
  ]
}
```

---

## Template Management

### List Templates

View all available templates:

```bash
knhk gen templates list
```

Output:
```
Available Templates (2):

1. workflow-basic (v1.0.0)
   Category: workflow
   Language: rust
   Description: Basic workflow template

2. chicago-tdd (v1.0.0)
   Category: testing
   Language: rust
   Description: Chicago TDD test template
```

### List Templates (JSON)

Machine-readable template list:

```bash
knhk gen templates list --format json
```

Output:
```json
{
  "templates": [
    {
      "name": "workflow-basic",
      "version": "1.0.0",
      "description": "Basic workflow template",
      "language": "rust",
      "category": "workflow"
    },
    {
      "name": "chicago-tdd",
      "version": "1.0.0",
      "description": "Chicago TDD test template",
      "language": "rust",
      "category": "testing"
    }
  ],
  "total_count": 2
}
```

### Search Templates

Find templates by keyword:

```bash
knhk gen templates search workflow
```

Output:
```
Search Results (1 match):

1. workflow-workflow (v1.0.0)
   Category: workflow
   Language: rust
   Description: Workflow template matching 'workflow'
```

### Preview Template

Preview template with sample data:

```bash
knhk gen templates preview workflow.tmpl
```

Output:
```
Template: workflow.tmpl

Preview of template: workflow.tmpl

// Template content here...
```

### Install Template

Install template from marketplace:

```bash
knhk gen templates install workflow-advanced
```

Output:
```
⏳ Installing template workflow-advanced...
✅ Installed to ~/.knhk/templates/workflow-advanced (0.52s)
```

### Install Specific Version

Install exact template version:

```bash
knhk gen templates install workflow-advanced@2.0.0
```

### Validate Template

Verify custom template:

```bash
knhk gen templates validate ./my-template.tmpl
```

Output:
```
Template: ./my-template.tmpl
Status: ✅ Valid

No issues found.
```

### Show Template Documentation

View template docs:

```bash
knhk gen templates docs workflow-basic
```

Output:
```
# Template: workflow-basic

Documentation for workflow-basic template.

## Usage

Example usage here...
```

---

## Marketplace Integration

### Publish Template

Publish template to marketplace:

```bash
knhk gen marketplace publish ./templates/my-template.tmpl
```

Output:
```
⏳ Publishing template...
✅ Template published (1.23s)

Template: my-template.tmpl
Version: 1.0.0
Marketplace URL: https://marketplace.knhk.io/templates/my-template
```

### Search Marketplace

Find templates in marketplace:

```bash
knhk gen marketplace search "workflow rust"
```

Output:
```
Marketplace Results (1 match):

1. workflow-workflow rust (v1.0.0)
   Author: KNHK Team
   Downloads: 1,234
   Rating: ⭐⭐⭐⭐½ (4.5/5.0)
   Description: Workflow template matching 'workflow rust'
```

### Search Marketplace (JSON)

Machine-readable marketplace search:

```bash
knhk gen marketplace search workflow --format json
```

Output:
```json
{
  "matches": [
    {
      "name": "workflow-workflow",
      "version": "1.0.0",
      "author": "KNHK Team",
      "description": "Workflow template matching 'workflow'",
      "downloads": 1234,
      "rating": 4.5
    }
  ],
  "match_count": 1
}
```

### Install from Marketplace

Install published template:

```bash
knhk gen marketplace install workflow-pro
```

Output:
```
⏳ Installing from marketplace...
✅ Installed workflow-pro (0.78s)

Template: workflow-pro
Version: 1.0.0
Location: ~/.knhk/templates/workflow-pro
```

### Show Template Ratings

View ratings and reviews:

```bash
knhk gen marketplace rating workflow-pro
```

Output:
```
Template: workflow-pro
Rating: ⭐⭐⭐⭐½ (4.5/5.0)
Reviews: 42

Recent Reviews:

1. user1 (⭐⭐⭐⭐⭐ 5.0/5.0) - 2025-11-15
   "Excellent template!"

2. user2 (⭐⭐⭐⭐ 4.0/5.0) - 2025-11-14
   "Good, but could use more examples"
```

### Show Ratings (JSON)

Machine-readable ratings:

```bash
knhk gen marketplace rating workflow-pro --format json
```

Output:
```json
{
  "name": "workflow-pro",
  "rating": 4.5,
  "review_count": 42,
  "reviews": [
    {
      "author": "user1",
      "rating": 5.0,
      "comment": "Excellent template!",
      "date": "2025-11-15"
    },
    {
      "author": "user2",
      "rating": 4.0,
      "comment": "Good, but could use more examples",
      "date": "2025-11-14"
    }
  ]
}
```

---

## Advanced Workflows

### Full Workflow: Generate + Test + Validate

Complete code generation workflow:

```bash
#!/bin/bash
set -e

# 1. Generate workflow
echo "Generating workflow..."
knhk gen workflow spec.ttl \
  --output src/workflow.rs \
  --emit-telemetry \
  --emit-hooks

# 2. Generate tests
echo "Generating tests..."
knhk gen tests spec.ttl \
  --output tests/ \
  --coverage 95

# 3. Validate code
echo "Validating code..."
knhk gen validate src/workflow.rs \
  --telemetry \
  --performance \
  --weaver

echo "✅ Complete workflow finished!"
```

### CI/CD Pipeline Integration

GitHub Actions workflow:

```yaml
name: Code Generation

on:
  push:
    paths:
      - 'specs/**/*.ttl'

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install KNHK
        run: cargo install --path rust/knhk-cli

      - name: Generate Workflow
        run: |
          knhk gen workflow specs/workflow.ttl \
            --output src/generated/workflow.rs \
            --emit-telemetry \
            --format json > gen-report.json

      - name: Generate Tests
        run: |
          knhk gen tests specs/workflow.ttl \
            --output tests/generated/ \
            --coverage 90

      - name: Validate Generated Code
        run: |
          knhk gen validate src/generated/workflow.rs \
            --weaver \
            --format json > validation-report.json

      - name: Upload Reports
        uses: actions/upload-artifact@v4
        with:
          name: generation-reports
          path: |
            gen-report.json
            validation-report.json

      - name: Commit Generated Files
        if: success()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add src/generated/ tests/generated/
          git commit -m "chore: regenerate code from specifications"
          git push
```

### Batch Generation

Generate multiple workflows:

```bash
#!/bin/bash

SPECS_DIR="specs"
OUTPUT_DIR="src/generated"

mkdir -p "$OUTPUT_DIR"

# Generate all workflows
for spec in "$SPECS_DIR"/*.ttl; do
  name=$(basename "$spec" .ttl)
  echo "Generating $name..."

  knhk gen workflow "$spec" \
    --output "$OUTPUT_DIR/${name}.rs" \
    --emit-telemetry \
    --emit-hooks
done

echo "✅ Generated $(ls "$OUTPUT_DIR"/*.rs | wc -l) workflows"
```

### Template Customization Workflow

Create and publish custom template:

```bash
# 1. Create template
cat > my-workflow.tmpl <<'EOF'
//! Custom Workflow Template
//! Generated by: KNHK ggen v2.7.1

pub struct {{workflow_name}} {
    pub name: String,
    pub version: String,
}

impl {{workflow_name}} {
    pub fn new() -> Self {
        Self {
            name: "{{workflow_name}}".to_string(),
            version: "1.0.0".to_string(),
        }
    }
}
EOF

# 2. Validate template
knhk gen templates validate my-workflow.tmpl

# 3. Test template
knhk gen workflow spec.ttl \
  --template my-workflow.tmpl \
  --output test-workflow.rs

# 4. Publish to marketplace
knhk gen marketplace publish my-workflow.tmpl
```

### Multi-Language Project Setup

Generate for all languages:

```bash
#!/bin/bash

SPEC="specs/workflow.ttl"

# Rust
knhk gen workflow "$SPEC" \
  --language rust \
  --output rust/src/workflow.rs \
  --emit-telemetry

# Python
knhk gen workflow "$SPEC" \
  --language python \
  --output python/workflow.py

# JavaScript
knhk gen workflow "$SPEC" \
  --language js \
  --output js/src/workflow.js

# Go
knhk gen workflow "$SPEC" \
  --language go \
  --output go/workflow.go

echo "✅ Generated workflow for 4 languages"
```

---

## Error Examples

### File Not Found

```bash
knhk gen workflow nonexistent.ttl
```

Output:
```
⏳ Generating workflow from specification...
❌ Generating workflow from specification - Specification file not found (0.01s)

Error: Specification file not found: nonexistent.ttl
```

### Invalid Coverage Percentage

```bash
knhk gen tests spec.ttl --coverage 150
```

Output:
```
⏳ Generating Chicago TDD tests...
❌ Generating Chicago TDD tests - Coverage percentage must be <= 100 (0.01s)

Error: Coverage percentage must be between 0 and 100
```

### Invalid Language

```bash
knhk gen workflow spec.ttl --language cobol
```

Output:
```
error: invalid value 'cobol' for '--language <LANG>'
  [possible values: rust, python, js, go]

For more information, try '--help'.
```

---

## Help Output

### Command Help

```bash
knhk gen workflow --help
```

Output:
```
Generate Rust workflow from RDF/Turtle specification

Usage: knhk gen workflow [OPTIONS] <SPEC_FILE>

Arguments:
  <SPEC_FILE>  Path to RDF/Turtle specification file

Options:
      --template <TEMPLATE>    Template to use (default: workflow.tmpl)
  -o, --output <OUTPUT>        Output file (default: stdout)
  -l, --language <LANG>        Target language: rust|python|js|go [default: rust]
      --validate               Validate against Weaver schema
      --emit-hooks             Generate knowledge hooks
      --emit-telemetry         Generate OTEL telemetry
      --format <FORMAT>        Output format for metadata [default: text]
  -h, --help                   Print help

Examples:
  # Generate workflow from Turtle file
  knhk gen workflow spec.ttl

  # Generate with specific output file
  knhk gen workflow spec.ttl --output workflow.rs

  # Generate for Python with telemetry
  knhk gen workflow spec.ttl --language python --emit-telemetry

  # Validate against Weaver schema
  knhk gen workflow spec.ttl --validate --emit-telemetry
```

---

## Conclusion

The ggen v2.7.1 CLI provides comprehensive code generation capabilities with:

- ✅ Multi-language support (Rust, Python, JavaScript, Go)
- ✅ Chicago TDD test generation
- ✅ Knowledge hook generation
- ✅ Weaver validation integration
- ✅ Template management system
- ✅ Marketplace integration
- ✅ OTEL telemetry support
- ✅ Lockchain receipt generation
- ✅ Progress indicators
- ✅ Structured output formats

All commands follow KNHK best practices with proper error handling, telemetry, and user-friendly output.
