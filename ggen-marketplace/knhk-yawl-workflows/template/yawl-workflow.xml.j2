{#- YAWL XML Template -#}
{#- Generates YAWL 2.2 XML specification from RDF ontology -#}
{#- Generated by: ggen template generate-rdf --ontology <turtle> --template io.knhk.yawl-workflows -#}
<?xml version="1.0" encoding="UTF-8"?>
<YAWL xmlns="http://www.yawlfoundation.org/yawlschema/YAWL_Schema_Version_2.2">
  <SpecificationSet>
    {% for workflow in workflows %}
    <Specification URI="{{ workflow.workflow }}">
      {#- Metadata -#}
      <Metadata>
        <Title>{{ workflow.workflowLabel | default("Unnamed Workflow") }}</Title>
        <Description>{{ workflow.workflowDescription | default("No description provided") }}</Description>
        <Creator>KNHK YAWL Generator</Creator>
        <Version>1.0</Version>
        <Identifier>{{ workflow.workflow }}</Identifier>
      </Metadata>

      {#- Net Definition -#}
      <Net id="workflow_net">
        {#- Places (Conditions) -#}
        <Place id="InputCondition">
          <Name>Input Condition</Name>
          <Graphics>
            <Position x="0" y="0" />
          </Graphics>
          <Token id="Default" value="True" />
        </Place>

        {% for condition in conditions %}
        {% if condition.conditionLabel %}
        <Place id="{{ condition.condition | replace('/', '_') | replace('#', '') }}">
          <Name>{{ condition.conditionLabel }}</Name>
          {% if condition.conditionDescription %}
          <Documentation>{{ condition.conditionDescription }}</Documentation>
          {% endif %}
          <Graphics>
            <Position x="{% cycle 100, 200, 300, 400, 500 %}" y="{% cycle 100, 200, 300 %}" />
          </Graphics>
          {% if condition.initialMarking %}
          <Token id="Default" value="{{ condition.initialMarking }}" />
          {% else %}
          <Token id="Default" value="False" />
          {% endif %}
        </Place>
        {% endif %}
        {% endfor %}

        <Place id="OutputCondition">
          <Name>Output Condition</Name>
          <Graphics>
            <Position x="600" y="100" />
          </Graphics>
        </Place>

        {#- Transitions (Tasks) -#}
        {% for task in tasks %}
        {% if task.taskLabel %}
        <Transition id="{{ task.task | replace('/', '_') | replace('#', '') }}">
          <Name>{{ task.taskLabel }}</Name>
          {% if task.taskDescription %}
          <Documentation>{{ task.taskDescription }}</Documentation>
          {% endif %}

          {#- Task Routing Properties -#}
          <Configuration>
            <Documentation>
              <Title>Routing Configuration</Title>
              {% if task.splitType %}
              <Text>Split Type: {{ task.splitType }}</Text>
              {% endif %}
              {% if task.joinType %}
              <Text>Join Type: {{ task.joinType }}</Text>
              {% endif %}
              {% if task.isMultiInstance %}
              <Text>Multi-Instance: {{ task.isMultiInstance }}</Text>
              {% endif %}
            </Documentation>
          </Configuration>

          <Graphics>
            <Position x="{% cycle 150, 250, 350, 450 %}" y="{% cycle 150, 250, 350 %}" />
            <Size width="60" height="40" />
          </Graphics>

          {#- Incoming Flows -#}
          {% for flow in flows %}
            {% if flow.target == task.task %}
          <PostSet>
            <Arc id="arc_{{ flow.source | replace('/', '_') | replace('#', '') }}_to_{{ task.task | replace('/', '_') | replace('#', '') }}"
                 source="{{ flow.source | replace('/', '_') | replace('#', '') }}"
                 target="{{ task.task | replace('/', '_') | replace('#', '') }}">
              {% if flow.flowCondition %}
              <Predicate>{{ flow.flowCondition }}</Predicate>
              {% endif %}
            </Arc>
          </PostSet>
            {% endif %}
          {% endfor %}

          {#- Outgoing Flows -#}
          {% for flow in flows %}
            {% if flow.source == task.task %}
          <PreSet>
            <Arc id="arc_{{ task.task | replace('/', '_') | replace('#', '') }}_to_{{ flow.target | replace('/', '_') | replace('#', '') }}"
                 source="{{ task.task | replace('/', '_') | replace('#', '') }}"
                 target="{{ flow.target | replace('/', '_') | replace('#', '') }}">
              {% if flow.flowCondition %}
              <Predicate>{{ flow.flowCondition }}</Predicate>
              {% endif %}
            </Arc>
          </PreSet>
            {% endif %}
          {% endfor %}
        </Transition>
        {% endif %}
        {% endfor %}

        {#- Flow Connections -#}
        {% for flow in flows %}
        {% if flow.flowLabel %}
        {#- Arc definition is included in pre/post sets above -#}
        {% endif %}
        {% endfor %}
      </Net>

      {#- Layout Information -#}
      <Layout>
        <GraphicalDescription>
          <Size x="800" y="600" />
          <NetGraphicalDescription id="workflow_net">
            <SizeConstraints x="800" y="600" />
            <Viewport x="0" y="0" />
          </NetGraphicalDescription>
        </GraphicalDescription>
      </Layout>
    </Specification>
    {% endfor %}
  </SpecificationSet>
</YAWL>
